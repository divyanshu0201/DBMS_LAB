create database book3;
use book3;
CREATE TABLE PUBLISHER
(NAME VARCHAR(20),
PHONE VARCHAR(11),
ADDRESS VARCHAR(20),
primary key(NAME));
CREATE TABLE BOOK
(BOOK_ID INT,
TITLE VARCHAR(20),
PUB_YEAR VARCHAR(20),
PUBLISHER_NAME VARCHAR(20),
PRIMARY KEY(BOOK_ID),
FOREIGN KEY(PUBLISHER_NAME) REFERENCES PUBLISHER(NAME) ON DELETE CASCADE
);
CREATE TABLE BOOK_AUTHORS
(AUTHOR_NAME VARCHAR(20),
BOOK_ID INT,
PRIMARY KEY (BOOK_ID, AUTHOR_NAME),
FOREIGN KEY(BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE
);
CREATE TABLE LIBRARY_BRANCH
(BRANCH_ID INT,
BRANCH_NAME VARCHAR(50),
ADDRESS VARCHAR(50),
PRIMARY KEY(BRANCH_ID));
CREATE TABLE BOOK_COPIES
(NO_OF_COPIES INT,
BOOK_ID INT,
BRANCH_ID INT,
PRIMARY KEY (BOOK_ID, BRANCH_ID),
FOREIGN KEY(BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
FOREIGN KEY(BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE
);
CREATE TABLE CARD
(CARD_NO INT PRIMARY KEY);
CREATE TABLE BOOK_LENDING
(DATE_OUT DATE,
DUE_DATE DATE,
BOOK_ID INT,
BRANCH_ID INT,
CARD_NO INT,
PRIMARY KEY (BOOK_ID, BRANCH_ID, CARD_NO),
FOREIGN KEY(BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
FOREIGN KEY(BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE);
INSERT INTO PUBLISHER VALUES ('MCGRAW-HILL', '9989076587', 'BANGALORE'), ('PEARSON', '9889076565', 'NEWDELHI'),
('RANDOM HOUSE', '7455679345', 'HYDRABAD'),('HACHETTE LIVRE', '8970862340', 'CHENAI'), ('GRUPO PLANETA', '7756120238', 'BANGALORE');
INSERT INTO BOOK VALUES (1,'DBMS','JAN-2017', 'MCGRAW-HILL'),(2,'ADBMS','JUN-2016', 'MCGRAW-HILL'),(3,'CN','SEP-2016', 'PEARSON'),
(4,'CG','SEP-2015', 'GRUPO PLANETA'),(5,'OS','MAY-2016', 'PEARSON');
INSERT INTO BOOK_AUTHORS VALUES ('NAVATHE', 1),('NAVATHE', 2),('TANENBAUM', 3),('EDWARD ANGEL', 4),('GALVIN', 5);
INSERT INTO LIBRARY_BRANCH VALUES (10,'RR NAGAR','BANGALORE'),
(11,'RNSIT','BANGALORE'),(12,'RAJAJI NAGAR', 'BANGALORE'),(13,'NITTE','MANGALORE'),(14,'MANIPAL','UDUPI');
INSERT INTO BOOK_COPIES VALUES (10, 1, 10),(5, 1, 11),(2, 2, 12),(5, 2, 13),(7, 3, 14),(1, 5, 10),(3, 4, 11);
INSERT INTO CARD VALUES (100),(101),
(102),(103),(104);
INSERT INTO BOOK_LENDING VALUES ('2017-01-01','2017-06-01', 1, 10, 101),('2017-01-11','2017-03-11', 3, 14, 101),
('2017-02-21','2017-04-21', 2, 13, 101),('2017-03-15','2017-07-15', 4, 11, 101),('2017-04-12','2017-05-12', 1, 11, 104);

SELECT * FROM PUBLISHER;

SELECT * FROM BOOK;

SELECT * FROM BOOK_AUTHORS;

SELECT * FROM BOOK_COPIES;

SELECT * FROM CARD;

SELECT * FROM BOOK_LENDING;

SELECT B.BOOK_ID, B.TITLE, B.PUBLISHER_NAME, A.AUTHOR_NAME,
C.NO_OF_COPIES, L.BRANCH_ID
FROM BOOK B, BOOK_AUTHORS A, BOOK_COPIES C, LIBRARY_BRANCH L
WHERE B.BOOK_ID=A.BOOK_ID
AND B.BOOK_ID=C.BOOK_ID
AND L.BRANCH_ID=C.BRANCH_ID;

SELECT CARD_NO
FROM BOOK_LENDING
WHERE DATE_OUT BETWEEN '2017-01-01' AND '2017-07-01'
GROUP BY CARD_NO HAVING COUNT(*)>3;

DELETE FROM BOOK
WHERE BOOK_ID=3;

CREATE VIEW V_PUBLICATION AS
SELECT PUB_YEAR
FROM BOOK;

SELECT * FROM V_PUBLICATION;


CREATE VIEW V_BOOKS AS
SELECT B.BOOK_ID, B.TITLE, C.NO_OF_COPIES
FROM BOOK B, BOOK_COPIES C, LIBRARY_BRANCH L
WHERE B.BOOK_ID=C.BOOK_ID
AND C.BRANCH_ID=L.BRANCH_ID;

SELECT * FROM V_BOOKS;



